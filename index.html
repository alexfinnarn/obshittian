<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal MD Editor</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Fuse.js for fuzzy search -->
    <script src="https://cdn.jsdelivr.net/npm/fuse.js@7.0.0"></script>
    <!-- Pikaday Calendar -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday@1.8.2/css/pikaday.css">
    <script src="https://cdn.jsdelivr.net/npm/pikaday@1.8.2/pikaday.js" onerror="console.error('Failed to load Pikaday from CDN')"></script>
    <!-- CodeMirror 6 - all from same bundle to avoid duplicate instances -->
    <script type="module">
        import * as CMState from 'https://esm.sh/@codemirror/state@6.4.0';
        import * as CMView from 'https://esm.sh/@codemirror/view@6.26.0?deps=@codemirror/state@6.4.0';
        import {basicSetup} from 'https://esm.sh/codemirror@6.0.1?deps=@codemirror/state@6.4.0,@codemirror/view@6.26.0';
        import {markdown, markdownLanguage} from 'https://esm.sh/@codemirror/lang-markdown@6.2.0?deps=@codemirror/state@6.4.0,@codemirror/view@6.26.0';
        import {yaml} from 'https://esm.sh/@codemirror/lang-yaml@6.1.1?deps=@codemirror/state@6.4.0,@codemirror/view@6.26.0';
        import {oneDark} from 'https://esm.sh/@codemirror/theme-one-dark@6.1.0?deps=@codemirror/state@6.4.0,@codemirror/view@6.26.0';

        // Expose to global scope for use in main script
        window.CM = {
            EditorView: CMView.EditorView,
            EditorState: CMState.EditorState,
            basicSetup,
            markdown,
            markdownLanguage,
            yaml,
            oneDark
        };
        window.dispatchEvent(new Event('codemirror-ready'));
    </script>
    <link rel="stylesheet" href="style.css">
    <script src="config.js"></script>
</head>
<body>

    <!-- Sidebar -->
    <div id="sidebar" data-testid="sidebar">
        <div class="sidebar-section sidebar-buttons">
            <button id="btnOpenFolder" data-testid="btn-open-folder">üìÇ Open Folder</button>
            <button id="btnRestoreFolder" data-testid="btn-restore-folder" style="display: none;">üîÑ Restore Folder</button>
        </div>

        <div class="sidebar-section">
            <div id="calendar-container" data-testid="calendar-container"></div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header with-action">
                <span>Quick Links</span>
                <button class="configure-btn" id="configure-quick-links" data-testid="btn-configure-quick-links" title="Configure links">Configure</button>
            </div>
            <div class="quick-links" data-testid="quick-links"></div>
        </div>

        <div class="sidebar-section" style="flex: 1; display: flex; flex-direction: column; border-bottom: none; overflow: hidden;">
            <div class="sidebar-tabs" data-testid="sidebar-tabs">
                <button class="sidebar-tab active" data-tab="files" data-testid="tab-files">Files</button>
                <button class="sidebar-tab" data-tab="search" data-testid="tab-search">Search</button>
            </div>
            <div class="tab-content" id="files-tab" data-testid="files-tab">
                <div id="file-tree" data-testid="file-tree"></div>
            </div>
            <div class="tab-content" id="search-tab" data-testid="search-tab" style="display: none;">
                <div class="search-container">
                    <input type="text" id="tag-search" data-testid="tag-search" placeholder="Search tags...">
                </div>
                <div id="tag-results" data-testid="tag-results"></div>
                <div id="file-results" data-testid="file-results"></div>
            </div>
        </div>
    </div>

    <!-- Main Content: Two Editor Panes -->
    <div id="main" data-testid="main-content">
        <!-- Left Pane (Working Document) -->
        <div class="editor-pane" id="left-pane" data-testid="left-pane">
            <div class="pane-toolbar" data-testid="left-toolbar">
                <span class="pane-filename left" id="left-filename" data-testid="left-filename">No file open</span>
                <span class="unsaved-indicator" id="left-unsaved" data-testid="left-unsaved">‚óè</span>
                <div class="view-toggle" data-testid="left-view-toggle">
                    <button class="active" data-pane="left" data-view="edit" data-testid="left-btn-edit" title="Edit">‚úèÔ∏è</button>
                    <button data-pane="left" data-view="split" data-testid="left-btn-split" title="Split">‚ó´</button>
                    <button data-pane="left" data-view="preview" data-testid="left-btn-preview" title="Preview">üëÅ</button>
                </div>
            </div>
            <div class="pane-content" data-testid="left-pane-content">
                <div class="editor-container" id="left-editor" data-testid="left-editor"></div>
                <div class="preview-pane" id="left-preview" data-testid="left-preview"></div>
            </div>
        </div>

        <div class="resizer" id="pane-resizer" data-testid="pane-resizer"></div>

        <!-- Right Pane (Daily Note) -->
        <div class="editor-pane" id="right-pane" data-testid="right-pane">
            <div class="pane-toolbar" data-testid="right-toolbar">
                <span class="pane-filename right" id="right-filename" data-testid="right-filename">No daily note</span>
                <span class="unsaved-indicator" id="right-unsaved" data-testid="right-unsaved">‚óè</span>
                <div class="view-toggle" data-testid="right-view-toggle">
                    <button class="active" data-pane="right" data-view="edit" data-testid="right-btn-edit" title="Edit">‚úèÔ∏è</button>
                    <button data-pane="right" data-view="split" data-testid="right-btn-split" title="Split">‚ó´</button>
                    <button data-pane="right" data-view="preview" data-testid="right-btn-preview" title="Preview">üëÅ</button>
                </div>
            </div>
            <div class="pane-content" data-testid="right-pane-content">
                <div class="editor-container" id="right-editor" data-testid="right-editor"></div>
                <div class="preview-pane" id="right-preview" data-testid="right-preview"></div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="context-menu" data-testid="context-menu">
        <div class="context-menu-item" data-action="new-file" data-testid="context-menu-new-file">New File</div>
        <div class="context-menu-item" data-action="new-folder" data-testid="context-menu-new-folder">New Folder</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="rename" data-testid="context-menu-rename">Rename</div>
        <div class="context-menu-item" data-action="delete" data-testid="context-menu-delete">Delete</div>
    </div>

    <!-- Quick Links Modal -->
    <div class="modal" id="quick-links-modal" data-testid="quick-links-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">Configure Quick Links</span>
                <button class="modal-close" data-testid="modal-close">√ó</button>
            </div>
            <div class="modal-body">
                <div id="quick-links-editor" data-testid="quick-links-editor"></div>
                <button id="quick-links-add" class="btn-add-link" data-testid="btn-add-link">+ Add Link</button>
            </div>
            <div class="modal-footer">
                <button id="quick-links-cancel" data-testid="btn-quick-links-cancel">Cancel</button>
                <button id="quick-links-save" class="btn-primary" data-testid="btn-quick-links-save">Save</button>
            </div>
        </div>
    </div>

    <!-- Main application module -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
