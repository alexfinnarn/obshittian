<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minimal MD Editor</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <!-- Pikaday Calendar -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pikaday@1.8.2/css/pikaday.css">
    <script src="https://cdn.jsdelivr.net/npm/pikaday@1.8.2/pikaday.js" onerror="console.error('Failed to load Pikaday from CDN')"></script>
    <!-- CodeMirror 6 - all from same bundle to avoid duplicate instances -->
    <script type="module">
        import * as CMState from 'https://esm.sh/@codemirror/state@6.4.0';
        import * as CMView from 'https://esm.sh/@codemirror/view@6.26.0?deps=@codemirror/state@6.4.0';
        import {basicSetup} from 'https://esm.sh/codemirror@6.0.1?deps=@codemirror/state@6.4.0,@codemirror/view@6.26.0';
        import {markdown, markdownLanguage} from 'https://esm.sh/@codemirror/lang-markdown@6.2.0?deps=@codemirror/state@6.4.0,@codemirror/view@6.26.0';
        import {oneDark} from 'https://esm.sh/@codemirror/theme-one-dark@6.1.0?deps=@codemirror/state@6.4.0,@codemirror/view@6.26.0';

        // Expose to global scope for use in main script
        window.CM = {
            EditorView: CMView.EditorView,
            EditorState: CMState.EditorState,
            basicSetup,
            markdown,
            markdownLanguage,
            oneDark
        };
        window.dispatchEvent(new Event('codemirror-ready'));
    </script>
    <link rel="stylesheet" href="style.css">
    <script src="config.js"></script>
</head>
<body>

    <!-- Sidebar -->
    <div id="sidebar">
        <div class="sidebar-section">
            <button id="btnOpenFolder" style="width: calc(100% - 16px); margin: 8px;">üìÇ Open Folder</button>
        </div>

        <div class="sidebar-section">
            <div id="calendar-container"></div>
        </div>

        <div class="sidebar-section">
            <div class="sidebar-section-header with-action">
                <span>Quick Links</span>
                <button class="configure-btn" id="configure-quick-links" title="Configure links">Configure</button>
            </div>
            <div class="quick-links"></div>
        </div>

        <div class="sidebar-section" style="flex: 1; display: flex; flex-direction: column; border-bottom: none;">
            <div class="sidebar-section-header">Files</div>
            <div id="file-tree"></div>
        </div>
    </div>

    <!-- Main Content: Two Editor Panes -->
    <div id="main">
        <!-- Left Pane (Working Document) -->
        <div class="editor-pane" id="left-pane">
            <div class="pane-toolbar">
                <span class="pane-filename left" id="left-filename">No file open</span>
                <span class="unsaved-indicator" id="left-unsaved">‚óè</span>
                <div class="view-toggle">
                    <button class="active" data-pane="left" data-view="edit" title="Edit">‚úèÔ∏è</button>
                    <button data-pane="left" data-view="split" title="Split">‚ó´</button>
                    <button data-pane="left" data-view="preview" title="Preview">üëÅ</button>
                </div>
            </div>
            <div class="pane-content">
                <div class="editor-container" id="left-editor"></div>
                <div class="preview-pane" id="left-preview"></div>
            </div>
        </div>

        <div class="resizer" id="pane-resizer"></div>

        <!-- Right Pane (Daily Note) -->
        <div class="editor-pane" id="right-pane">
            <div class="pane-toolbar">
                <span class="pane-filename right" id="right-filename">No daily note</span>
                <span class="unsaved-indicator" id="right-unsaved">‚óè</span>
                <div class="view-toggle">
                    <button class="active" data-pane="right" data-view="edit" title="Edit">‚úèÔ∏è</button>
                    <button data-pane="right" data-view="split" title="Split">‚ó´</button>
                    <button data-pane="right" data-view="preview" title="Preview">üëÅ</button>
                </div>
            </div>
            <div class="pane-content">
                <div class="editor-container" id="right-editor"></div>
                <div class="preview-pane" id="right-preview"></div>
            </div>
        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="context-menu">
        <div class="context-menu-item" data-action="new-file">New File</div>
        <div class="context-menu-item" data-action="new-folder">New Folder</div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" data-action="rename">Rename</div>
        <div class="context-menu-item" data-action="delete">Delete</div>
    </div>

    <!-- Quick Links Modal -->
    <div class="modal" id="quick-links-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">Configure Quick Links</span>
                <button class="modal-close">√ó</button>
            </div>
            <div class="modal-body">
                <div id="quick-links-editor"></div>
                <button id="quick-links-add" class="btn-add-link">+ Add Link</button>
            </div>
            <div class="modal-footer">
                <button id="quick-links-cancel">Cancel</button>
                <button id="quick-links-save" class="btn-primary">Save</button>
            </div>
        </div>
    </div>

    <!-- Main application module -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
